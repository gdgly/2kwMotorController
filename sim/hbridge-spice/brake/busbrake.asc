Version 4
SHEET 1 1876 1568
WIRE 816 736 784 736
WIRE 832 736 816 736
WIRE 992 736 960 736
WIRE 1008 736 992 736
WIRE -1200 752 -1408 752
WIRE -768 752 -1200 752
WIRE -608 752 -768 752
WIRE -304 752 -608 752
WIRE 784 752 784 736
WIRE 960 752 960 736
WIRE 336 768 320 768
WIRE 560 768 544 768
WIRE -768 784 -768 752
WIRE -304 800 -304 752
WIRE 336 800 320 800
WIRE 560 800 544 800
WIRE 336 832 320 832
WIRE 560 832 544 832
WIRE 784 848 784 832
WIRE 960 848 960 832
WIRE 336 864 320 864
WIRE 560 880 544 880
WIRE -1200 896 -1200 752
WIRE -304 896 -304 880
WIRE 560 912 544 912
WIRE 816 928 784 928
WIRE 832 928 816 928
WIRE 992 928 960 928
WIRE 1008 928 992 928
WIRE -768 944 -768 864
WIRE -768 944 -944 944
WIRE -592 944 -768 944
WIRE 560 944 544 944
WIRE 784 944 784 928
WIRE 960 944 960 928
WIRE -944 976 -944 944
WIRE -592 976 -592 944
WIRE -192 976 -256 976
WIRE -192 992 -192 976
WIRE -112 1008 -144 1008
WIRE 80 1024 -48 1024
WIRE 16 1040 -48 1040
WIRE 784 1040 784 1024
WIRE 960 1040 960 1024
WIRE -1408 1056 -1408 752
WIRE -1120 1056 -1136 1056
WIRE -1104 1056 -1120 1056
WIRE -1008 1056 -1024 1056
WIRE -992 1056 -1008 1056
WIRE -528 1056 -544 1056
WIRE -512 1056 -528 1056
WIRE -416 1056 -432 1056
WIRE -400 1056 -416 1056
WIRE -144 1072 -144 1056
WIRE -144 1072 -192 1072
WIRE -1120 1088 -1120 1056
WIRE -1088 1088 -1120 1088
WIRE -1008 1088 -1008 1056
WIRE -1008 1088 -1024 1088
WIRE -944 1088 -944 1072
WIRE -832 1088 -944 1088
WIRE -592 1088 -592 1072
WIRE -592 1088 -640 1088
WIRE -528 1088 -528 1056
WIRE -512 1088 -528 1088
WIRE -416 1088 -416 1056
WIRE -416 1088 -448 1088
WIRE -192 1088 -192 1072
WIRE 16 1088 16 1040
WIRE -944 1104 -944 1088
WIRE -592 1104 -592 1088
WIRE 272 1120 240 1120
WIRE 320 1120 272 1120
WIRE 448 1120 400 1120
WIRE 640 1152 560 1152
WIRE 720 1152 640 1152
WIRE 816 1152 784 1152
WIRE 848 1152 816 1152
WIRE 640 1168 640 1152
WIRE 784 1168 784 1152
WIRE -1120 1184 -1136 1184
WIRE -1104 1184 -1120 1184
WIRE -1008 1184 -1024 1184
WIRE -992 1184 -1008 1184
WIRE -528 1184 -544 1184
WIRE -512 1184 -528 1184
WIRE -416 1184 -432 1184
WIRE -400 1184 -416 1184
WIRE 16 1184 16 1168
WIRE 720 1184 720 1152
WIRE 736 1184 720 1184
WIRE -1120 1216 -1120 1184
WIRE -1088 1216 -1120 1216
WIRE -1008 1216 -1008 1184
WIRE -1008 1216 -1024 1216
WIRE -528 1216 -528 1184
WIRE -512 1216 -528 1216
WIRE -416 1216 -416 1184
WIRE -416 1216 -448 1216
WIRE 272 1216 240 1216
WIRE 448 1216 272 1216
WIRE 736 1232 720 1232
WIRE 640 1264 640 1248
WIRE 720 1264 720 1232
WIRE 720 1264 640 1264
WIRE 784 1264 784 1248
WIRE 784 1264 720 1264
WIRE 640 1280 640 1264
WIRE -1408 1296 -1408 1136
WIRE -1360 1296 -1408 1296
WIRE -1200 1296 -1200 960
WIRE -1200 1296 -1264 1296
WIRE -944 1296 -944 1200
WIRE -944 1296 -1200 1296
WIRE -768 1296 -944 1296
WIRE -592 1296 -592 1200
WIRE -592 1296 -768 1296
WIRE -304 1296 -304 992
WIRE -304 1296 -592 1296
WIRE -768 1360 -768 1296
WIRE -1280 1376 -1280 1344
WIRE -176 1376 -208 1376
WIRE -64 1376 -96 1376
WIRE -16 1376 -64 1376
WIRE 80 1376 80 1024
WIRE 80 1376 48 1376
WIRE -64 1408 -64 1376
WIRE -1280 1472 -1280 1456
WIRE -64 1488 -64 1472
FLAG 816 736 Vduty
FLAG 784 848 0
FLAG 320 768 Vduty
FLAG 320 800 Vdir
FLAG 320 832 Vbrake
FLAG 320 864 Vmode
FLAG 560 800 M+
FLAG 560 912 M-
FLAG 992 736 Vdir
FLAG 960 848 0
FLAG 816 928 Vbrake
FLAG 784 1040 0
FLAG 992 928 Vmode
FLAG 960 1040 0
FLAG -640 1088 M-
FLAG -768 1360 0
FLAG -400 1056 HO2
FLAG 560 768 HO1
FLAG 560 832 LO1
FLAG 560 880 HO2
FLAG 560 944 LO2
FLAG -608 752 Vbus
FLAG -832 1088 M+
FLAG 272 1120 M+
FLAG 272 1216 M-
FLAG -1280 1472 0
FLAG -192 1088 0
FLAG 16 1184 0
FLAG -208 1376 Vbus
FLAG -64 1488 0
FLAG 640 1280 0
FLAG 640 1152 rad/s
FLAG 816 1152 krpm
FLAG -400 1184 LO2
FLAG -1136 1056 HO1
FLAG -1136 1184 LO1
SYMBOL voltage 784 736 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -136 147 Left 2
SYMATTR Value PWL(0 0.98 {t_drive} 0.98 {t_drive + 0.1m} 0.3)
SYMATTR InstName Vduty
SYMBOL voltage 960 736 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName Vdir
SYMATTR Value 0
SYMBOL voltage 960 928 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName Vmode
SYMATTR Value 1
SYMBOL voltage 784 928 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -47 94 Left 2
SYMATTR Value 0
SYMATTR InstName Vbrake
SYMBOL nmos -992 976 R0
WINDOW 3 59 59 Left 2
SYMATTR Value IPP100N08N3
SYMATTR InstName M1
SYMBOL nmos -992 1104 R0
SYMATTR InstName M2
SYMATTR Value IPP100N08N3
SYMBOL nmos -544 976 M0
SYMATTR InstName M3
SYMATTR Value IPP100N08N3
SYMBOL nmos -544 1104 M0
SYMATTR InstName M4
SYMATTR Value IPP100N08N3
SYMBOL voltage -1408 1040 R0
WINDOW 123 0 0 Left 2
WINDOW 39 27 128 Left 2
WINDOW 3 24 104 Left 2
SYMATTR SpiceLine Rser=2m
SYMATTR Value {Vbatt}
SYMATTR InstName Vbattery
SYMBOL res 304 1136 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName Motor
SYMATTR Value 1µ
SYMBOL GateDriver 448 848 R0
SYMATTR InstName X1
SYMBOL cap -1184 896 M0
SYMATTR InstName Cbus
SYMATTR Value 5mF
SYMATTR SpiceLine Rser=5m IC={Vbatt}
SYMBOL res -784 768 R0
SYMATTR InstName Rsense
SYMATTR Value 1µ
SYMBOL res -288 784 M0
SYMATTR InstName Rbrake
SYMATTR Value 1
SYMATTR SpiceLine pwr=200
SYMBOL nmos -256 896 M0
WINDOW 3 59 59 Left 2
SYMATTR Value IPP100N08N3
SYMATTR InstName M5
SYMBOL voltage -1280 1360 R0
WINDOW 3 -291 145 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PWL(0 10 {t_drive} 10 {t_drive + 0.1m} 0)
SYMATTR InstName Vbus_dis
SYMBOL e -192 976 M0
SYMATTR InstName E1
SYMATTR Value 10
SYMBOL Digital\\and -80 960 M0
SYMATTR InstName A1
SYMBOL voltage 16 1072 R0
WINDOW 3 -286 149 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PULSE(0 1 0 1n 1n 50e-6 50e-6)
SYMATTR InstName V4
SYMBOL nmos -1360 1344 R270
WINDOW 3 -3 -14 VLeft 2
WINDOW 0 24 -14 VLeft 2
SYMATTR Value IPP100N08N3
SYMATTR InstName M6
SYMBOL Digital\\schmtbuf -16 1312 R0
WINDOW 3 8 103 Left 2
SYMATTR Value Vt={Vbatt+1} Vh=1
SYMATTR InstName A3
SYMBOL res -80 1360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 800
SYMBOL cap -48 1408 M0
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL DC_motor_model 496 1168 R0
SYMATTR InstName X2
SYMBOL current 640 1168 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I1
SYMATTR Value 0.1
SYMBOL e 784 1152 R0
SYMATTR InstName E2
SYMATTR Value 9.55e-3
SYMBOL res -416 1040 R90
WINDOW 0 1 77 VBottom 2
WINDOW 3 -27 32 VTop 2
SYMATTR InstName R2
SYMATTR Value 250
SYMBOL res -416 1168 R90
WINDOW 0 1 77 VBottom 2
WINDOW 3 -27 32 VTop 2
SYMATTR InstName R3
SYMATTR Value 250
SYMBOL res -1120 1040 M90
WINDOW 0 1 77 VBottom 2
WINDOW 3 -27 32 VTop 2
SYMATTR InstName R4
SYMATTR Value 250
SYMBOL schottky -1024 1104 M270
WINDOW 0 -28 4 VTop 2
WINDOW 3 -1 68 VBottom 2
SYMATTR InstName D3
SYMATTR Value MBR735
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res -1120 1168 M90
WINDOW 0 1 77 VBottom 2
WINDOW 3 -27 32 VTop 2
SYMATTR InstName R5
SYMATTR Value 250
SYMBOL schottky -1024 1232 M270
WINDOW 0 -28 4 VTop 2
WINDOW 3 -1 68 VBottom 2
SYMATTR InstName D1
SYMATTR Value MBR735
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky -512 1232 R270
WINDOW 0 -28 4 VTop 2
WINDOW 3 -1 68 VBottom 2
SYMATTR InstName D2
SYMATTR Value MBR735
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky -512 1104 R270
WINDOW 0 -28 4 VTop 2
WINDOW 3 -1 68 VBottom 2
SYMATTR InstName D4
SYMATTR Value MBR735
SYMATTR Description Diode
SYMATTR Type diode
TEXT -112 776 Left 2 !.tran {t_drive + 0.1}
TEXT -112 808 Left 2 !.param t_drive=0.1
TEXT -112 840 Left 2 !.param Vbatt=48V
TEXT -1336 496 Left 2 ;Demonstration of regenerative braking effect when\nreducing duty cycle in sign-magnitude drive mode.\n \nIf Vbus_dis remains on, Vbattery will overcharge.\nIf Vbus_dis is turned off, but Rbrake is not utilized,\nVbus will become overcharged.
TEXT -304 696 Left 2 ;Brake power: V(Vbus,N001)*I(Rbrake)
